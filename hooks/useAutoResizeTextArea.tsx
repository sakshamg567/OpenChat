import { useCallback, useEffect, useRef } from "react"

interface useAutoResizeTextAreaProps {
   minHeight: number,
   maxHeight?: number
}


export default function useAutoResizeTextArea({
   minHeight,
   maxHeight
}: useAutoResizeTextAreaProps) {
   const textareaRef = useRef<HTMLTextAreaElement>(null);

   const adjustHeight = useCallback(
      (reset?: boolean) => {
         const textarea = textareaRef.current;
         if (!textarea) return;

         if (reset) {
            textarea.style.height = `${minHeight}px`;
            return;
         }

         textarea.style.height = `${minHeight}px`;

         const newHeight = Math.max(
            minHeight,
            Math.min(textarea.scrollHeight, maxHeight ?? Number.POSITIVE_INFINITY)
         )

         textarea.style.height = `${newHeight}px`;
      },
      [minHeight, maxHeight]
   )

   useEffect(() => {
      const textarea = textareaRef.current;
      if (textarea) {
         textarea.style.height = `${minHeight}px`;
      }
   }, [minHeight]);

   useEffect(() => {
      const handleResize = () => adjustHeight();
      window.addEventListener('resize', handleResize);
   }, [adjustHeight])

   return { textareaRef, adjustHeight };
}